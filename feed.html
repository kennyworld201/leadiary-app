<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leadiary | Live Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#172033', 900: '#0f172a', 950: '#020617' },
                        primary: '#10b981', 
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-200 font-sans antialiased flex h-screen overflow-hidden">

    <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col hidden md:flex">
        <div class="p-6 font-bold text-white text-xl flex items-center gap-2">
            <i data-lucide="radar" class="text-primary"></i> Leadiary
        </div>
        <nav class="px-4 space-y-1">
            <a href="feed.html" class="flex items-center gap-3 px-4 py-3 bg-slate-800 text-white rounded-lg font-medium">
                <i data-lucide="zap" class="w-5 h-5 text-primary"></i> Live Feed
            </a>
            <a href="dashboard.html" class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-all">
                <i data-lucide="crosshair" class="w-5 h-5"></i> Monitor Config
            </a>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col bg-slate-950 relative">
        <header class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-950/80 backdrop-blur">
            <h2 class="font-semibold text-lg text-white">Opportunity Feed</h2>
            <button onclick="loadLeads()" class="p-2 text-primary hover:bg-slate-800 rounded-full transition-all">
                <i data-lucide="refresh-cw" class="w-5 h-5"></i>
            </button>
        </header>

        <div id="feedContainer" class="flex-1 overflow-y-auto p-6 space-y-4 max-w-4xl mx-auto w-full">
            <div class="text-center text-slate-600 mt-20 animate-pulse">
                Connecting to Leadiary Cloud...
            </div>
        </div>
    </main>

    <script>
        // --- CONFIG ---
        const SUPABASE_URL = "https://ghvukliddwptqozsaian.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdodnVrbGlkZHdwdHFvenNhaWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNzk3NjcsImV4cCI6MjA4MzY1NTc2N30.VYBsUIflYKRWO8ZF00Ma9GcAA7zmnPXcry3N6NMI8R8";
        const { createClient } = supabase;
        const db = createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- LOAD LEADS ---
        async function loadLeads() {
            const container = document.getElementById('feedContainer');
            
            // Fetch leads from DB (Newest first)
            const { data, error } = await db
                .from('leads')
                .select('*')
                .order('created_at', { ascending: false })
                .limit(50);

            if (error) {
                console.error(error);
                container.innerHTML = `<div class="text-red-500 text-center">Error loading leads.</div>`;
                return;
            }

            container.innerHTML = ""; // Clear loading state

            if (data.length === 0) {
                container.innerHTML = `<div class="text-slate-500 text-center mt-10">No leads found yet. Start the bot!</div>`;
                return;
            }

            // Render each lead
            data.forEach(lead => {
                const card = document.createElement('div');
                card.className = "bg-slate-900 border border-slate-800 rounded-xl p-5 hover:border-slate-700 transition-all group";
                
                // Highlight keywords in content
                let contentHtml = lead.content.replace(new RegExp(lead.keyword, "gi"), match => 
                    `<span class="bg-primary/20 text-primary px-1 rounded">${match}</span>`
                );

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-slate-800 rounded-full flex items-center justify-center text-lg font-bold text-slate-400">
                                ${lead.author[1] || "?"}
                            </div>
                            <div>
                                <h3 class="font-bold text-white text-md leading-none">${lead.author}</h3>
                                <span class="text-xs text-slate-500">Found via "${lead.keyword}"</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                             <span class="bg-slate-950 border border-slate-800 text-slate-400 text-xs px-2 py-1 rounded-full">
                                ${new Date(lead.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                            </span>
                            <span class="bg-primary/10 text-primary text-xs font-bold px-2 py-1 rounded-full border border-primary/20">
                                ${lead.intent_score}% Intent
                            </span>
                        </div>
                    </div>
                    
                    <p class="text-slate-300 text-sm leading-relaxed mb-4 pl-1 border-l-2 border-slate-800">
                        ${contentHtml}
                    </p>

                    <div class="flex gap-3 mt-4 opacity-60 group-hover:opacity-100 transition-all">
                        <a href="https://twitter.com/${lead.author.replace('@','')}" target="_blank" 
                           class="flex-1 bg-primary hover:bg-emerald-500 text-slate-950 text-center font-bold py-2 rounded-lg text-sm transition-all flex items-center justify-center gap-2">
                            <i data-lucide="message-circle" class="w-4 h-4"></i> Reply on X
                        </a>
                        <button class="px-3 py-2 border border-slate-700 rounded-lg hover:bg-slate-800 text-slate-400">
                            <i data-lucide="thumbs-down" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
            lucide.createIcons();
        }

        // Init
        loadLeads();
        lucide.createIcons();
    </script>
</body>
</html>