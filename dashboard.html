<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leadiary | Control Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#172033', 900: '#0f172a', 950: '#020617' },
                        primary: '#10b981', 
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-200 font-sans antialiased flex h-screen overflow-hidden">

    <aside class="w-64 bg-slate-900 border-r border-slate-800 flex flex-col justify-between hidden md:flex">
        <div>
            <div class="p-6 flex items-center gap-2 font-bold text-white text-xl tracking-tight">
                <i data-lucide="radar" class="text-primary"></i> Leadiary
            </div>
            <nav class="px-4 space-y-1">
                <a href="/app" class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-all">
                    <i data-lucide="zap" class="w-5 h-5"></i> Live Feed
                </a>
                <a href="#" class="flex items-center gap-3 px-4 py-3 bg-slate-800 text-white rounded-lg transition-all font-medium">
                    <i data-lucide="crosshair" class="w-5 h-5 text-primary"></i> Lead Search
                </a>
            </nav>
        </div>
        <div class="p-4 border-t border-slate-800">
            <div class="text-xs text-slate-500 font-mono">Status: ðŸŸ¢ System Online</div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col bg-slate-950">
        <header class="h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-950/50 backdrop-blur-md">
            <h2 class="font-semibold text-lg text-white">Monitor Configuration</h2>
            <a href="/" class="text-sm text-slate-400 hover:text-white">Log Out</a>
        </header>

        <div class="flex-1 p-6 md:p-8 overflow-y-auto">
            <div class="max-w-3xl mx-auto">
                
                <div class="bg-slate-900 border border-slate-800 rounded-xl p-6 mb-8 shadow-lg">
                    <h3 class="text-white font-bold text-lg mb-2">Add New Target</h3>
                    <p class="text-slate-400 text-sm mb-4">What phrase signals that someone is ready to buy?</p>
                    
                    <div class="flex gap-3">
                        <input type="text" id="keywordInput" placeholder='e.g. "looking for a developer"' 
                            class="flex-1 bg-slate-950 border border-slate-700 text-white rounded-lg px-4 py-3 focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all placeholder:text-slate-600">
                        <button onclick="addKeyword()" class="bg-primary hover:bg-emerald-600 text-slate-950 font-bold px-6 py-3 rounded-lg transition-all flex items-center gap-2">
                            <i data-lucide="plus"></i> Add
                        </button>
                    </div>
                </div>

                <h3 class="text-slate-400 font-bold text-xs uppercase tracking-wider mb-4">Active Monitors</h3>
                <div id="keywordList" class="space-y-3">
                    <div class="text-slate-600 text-sm animate-pulse">Loading brain...</div>
                </div>

            </div>
        </div>
    </main>

    <script>
        // CONFIG
        const SUPABASE_URL = "https://ghvukliddwptqozsaian.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdodnVrbGlkZHdwdHFvenNhaWFuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgwNzk3NjcsImV4cCI6MjA4MzY1NTc2N30.VYBsUIflYKRWO8ZF00Ma9GcAA7zmnPXcry3N6NMI8R8";

        const { createClient } = supabase;
        const db = createClient(SUPABASE_URL, SUPABASE_KEY);

        // 1. LOAD KEYWORDS
        async function loadKeywords() {
            const { data, error } = await db.from('monitored_keywords').select('*').order('created_at', { ascending: false });
            
            const list = document.getElementById('keywordList');
            list.innerHTML = ""; 

            if (!data || data.length === 0) {
                list.innerHTML = `<div class="p-4 rounded-lg border border-dashed border-slate-800 text-slate-500 text-center">No keywords yet. Add one above.</div>`;
                return;
            }

            data.forEach(item => {
                const row = document.createElement('div');
                row.className = "flex items-center justify-between bg-slate-900/50 border border-slate-800/50 p-4 rounded-lg group hover:border-slate-700 transition-all";
                row.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="bg-primary/10 text-primary p-2 rounded-md"><i data-lucide="hash" class="w-4 h-4"></i></div>
                        <span class="text-slate-200 font-medium text-lg">"${item.keyword}"</span>
                    </div>
                    <button onclick="deleteKeyword(${item.id})" class="text-slate-600 hover:text-red-500 md:opacity-0 group-hover:opacity-100 transition-all p-2">
                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                    </button>
                `;
                list.appendChild(row);
            });
            lucide.createIcons();
        }

        // 2. ADD KEYWORD
        async function addKeyword() {
            const input = document.getElementById('keywordInput');
            const word = input.value.trim();
            if (!word) return;

            const { error } = await db.from('monitored_keywords').insert([{ keyword: word }]);
            if (error) { alert("Error adding keyword"); console.error(error); return; }
            
            input.value = "";
            loadKeywords();
        }

        // 3. DELETE KEYWORD
        async function deleteKeyword(id) {
            if(!confirm("Stop tracking this keyword?")) return;
            const { error } = await db.from('monitored_keywords').delete().eq('id', id);
            if (error) alert("Error deleting");
            loadKeywords();
        }

        lucide.createIcons();
        loadKeywords();
    </script>
</body>
</html>